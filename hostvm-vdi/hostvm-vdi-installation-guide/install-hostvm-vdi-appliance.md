# Руководство администратора HOSTVM VDI

## Глоссарий

|                    Понятие                   |                                       Определение                                      |
| :------------------------------------------: | :------------------------------------------------------------------------------------: |
|        Аутентификатор (Authenticator)        | Ресурс, обеспечивающий управление правами доступа пользователей к виртуальным ресурсам |
|         Базовый образ (Base Machine)         |                            Базовый шаблон виртуальной машины                           |
| Менеджеры операционной системы (OS Managers) |       Управляющий компонент для операционной системы виртуального рабочего места       |
|               Сервис (Service)               |                Ресурс, обеспечивающий выделение виртуальных рабочих мест               |
|          Тонкий клон (Linked Clone)          |               Клонированный образ виртуальной машины минимального размера              |
|            Транспорты (Transports)           |     Приложения для подключения к виртуальным рабочим местам по требуемым протоколам    |

## Общие данные

Руководство описывает действия администратора при настройке основных компонентов программного комплекса и содержит список и описание наиболее часто встречающихся команд.

## Администрирование HOSTVM VDI

Для первоначальной настройки и администрирования программного комплекса необходимо ввести IP-адрес или имя сервера VDI брокера (развернутого из VDI Appliance) через http или https доступ.

При первом входе в панель администрирования VDI необходимо ввести имя и пароль администратора, как показано на Рис. 1.

После входа, в панели администрирования можно изменить пароль, создать или выбрать новых пользователей, которым будет разрешен доступ.

![рис 1](../../.gitbook/assets/uds-1.png)

Если уже существует настроенная учетная запись пользователя с правами администратора для платформы VDI, необходимо ввести имя и пароль этого пользователя и выбрать тип аутентификации, который будет использоваться для входа.

Если настроено несколько аутентификаторов, и необходимо получить доступ к панели администрирования с помощью локальной учетной записи администратора, выбранный аутентификатор не будет использоваться, так как этот пользователь не будет сопоставлен с аутентификатором.

Для перехода к порталу администрирования необходимо выбрать **«Dashboard» ("Панель управления")** в меню пользователя.

![рис 2](../../.gitbook/assets/uds-2.png)

После открытия панели управления необходимо выполнить первоначальную конфигурацию компонентов, составляющих пул сервисов, для развертывания и подключения виртуальных рабочих столов и сервисов, поддерживаемых HOSTVM VDI.

![рис 3](../../.gitbook/assets/uds-3.png)

Конфигурация каждого пула сервисов составляется из различных элементов: подключение сервис-провайдера, настройка базовых образов виртуальных машин (для виртуальных рабочих столов), методов аутентификации пользователей, групп доступа, протоколов подключения. После настройки компонентов пула, можно приступать к его развертыванию.

## Настройка сервис-провайдеров

Сервис-провайдер отвечает за предоставление IP-сервисов.

Сервисы, предоставляемые платформой, могут быть виртуальными рабочими столами по требованию или приложениями, предоставляемыми платформой виртуализации или постоянными физическими/виртуальными рабочими столами, назначенными конкретным пользователям путем назначения IP-адресов.

Для создания пула сервисов должен быть создан хотя бы один сервис-провайдер.

Поддерживаемые типы сервис-провайдеров:

![рис 4](../../.gitbook/assets/uds-4.png)

## Настройка платформы VDI на базе HOSTVM

В данном разделе описано развертывание платформы VDI через виртуальную инфраструктуру HOSTVM.

### Регистрация сервис-провайдера HOSTVM

Для регистрации сервис-провайдера HOSTVM необходимо зайти в раздел «Services», нажать «New» и выбрать тип провайдера «oVirt/RHEV Platform Provider».

![рис 5](../../.gitbook/assets/uds-5.png)

При создании провайдера должны быть настроены следующие параметры:

**Основные:**

* имя (name) – имя сервисного провайдера;
* версия (oVirt Version) – версия подключаемой системы HOSTVM;
* хост (host) – имя или IP-адрес менеджера виртуализации;
* имя пользователя (username) – имя пользователя (в формате user@domain), имеющего доступ с правами администратора на менеджер виртуализации;
* пароль (password) – пароль пользователя;

![рис 6](../../.gitbook/assets/uds-6.png)

**Дополнительные:**

* количество одновременных задач создания рабочего стола (поле «Creation concurrency»);
* количество одновременных задач удаления рабочего стола (поле «Removal concurrency»);
* тайм-аут при установлении соединения с менеджером виртуализации;
* диапазон MAC-адресов для присвоения виртуальным рабочим столам.

![рис 7](../../.gitbook/assets/uds-7.png)

С помощью кнопки «Test» можно проверить, что соединение выполнено успешно.

После сохранения настроенные сервис-провайдеры будут подтверждены и готовы для создания базовых сервисов в HOSTVM.

Количество сервис-провайдеров типа HOSTVM, регистрируемых в рамках платформы, не ограничено.

Чтобы изменить какой-либо параметр в уже существующих сервис-провайдерах, необходимо выбрать его и нажать «Edit».

![рис 8](../../.gitbook/assets/uds-8.png)

С помощью кнопки «Enter Maintenance Mode» можно приостановить все операции, запущенные платформой для данного сервис-провайдера.

Рекомендуется поставить провайдер в режим обслуживания в случае потери связи или его остановки для обслуживания.

## Настройка сервиса на основе провайдера HOSTVM

После регистрации провайдера HOSTVM, в котором будут созданы рабочие столы, необходимо создать базовые сервисы для генерации тонких клонов ВМ.

Для этого следует открыть сервис-провайдер, в котором будет создан тонкий клон, с помощью двойного щелчка, либо выбором пункта “Detail” в контекстном меню провайдера:

![рис 9](../../.gitbook/assets/uds-9.png)

Нажать «New оVirt / RHEV Linked Clone» для создания нового базового сервиса. Минимальные параметры, которые необходимо настроить.

**Основные параметры:**

* имя (name) – имя сервиса;
* кластер (cluster) – кластер серверов HOSTVM, на котором будут размещены развернутые связанные клоны;
* домен хранилища данных (datastore domain) – хранилище, установленное для развертывания клонов ВМ;
* зарезервированное пространство (reserved space) – минимальное свободное пространство, которое может использоваться системой HOSTVM VDI.

![рис 10](../../.gitbook/assets/uds-10.png)

**Параметры ВМ:**

* базовый образ (base machine) – шаблон для развертывания виртуальных рабочих столов (golden image);
* память (memory) – объем памяти, который будет присвоен (в мегабайтах);
* гарантированная память (memory guaranteed) – объем памяти, который будет гарантированно доступен для тонких клонов;
* USB – если выбрано, то виртуальные рабочие столы будут поддерживать перенаправление USB-устройств;
* отображение (display) – протокол подключения виртуальных рабочих столов, развернутых через тонкий клон;
* имена машин (machine names) – префикс имени для всех тонких клонов, которые будут развернуты в этой службе (например, имена машин = win-);
* длина имени (name length) – длина номера суффикса, прикрепленного к корневому имени (например, Name Length = 3, win-000 ... win-999).

![рис 11](../../.gitbook/assets/uds-11.png)

После сохранения этой конфигурации будет готов действующий «HOSTVM / oVirt Linked Clone» на платформе HOSTVM.

Можно зарегистрировать необходимое количество «HOSTVM / oVirt Linked Clone» на платформе HOSTVM VDI.

![рис 12](../../.gitbook/assets/uds-12.png)

После настройки всех компонентов среды HOSTVM VDI (сервисы, аутентификаторы, менеджеры ОС и транспорты подключений) и создания пула сервисов на сервере HOSTVM Manager можно увидеть развернутые виртуальные рабочие столы на базе тонких клонов HOSTVM.

![Рис. 13](../../.gitbook/assets/uds-13.png)

## Управление методами аутентификации

Аутентификатор является основным компонентом платформы доставки рабочих столов, так как позволяет пользователям и группам пользователей, которым предоставлены учетные данные, подключаться к различным сервисам на рабочих столах.

Если в пуле сервисов не назначен хотя бы один аутентификатор, не будет возможности для подключения пользователей к сервисам рабочих столов платформы.

В зависимости от деятельности и платформы можно выбирать внешние аутентификаторы (Active Directory, OpenLDAP и т.д.) или внутренние (внутренняя база данных и аутентификация по IP).

![Рис. 14](../../.gitbook/assets/uds-14.png)

### Аутентификатор Active Directory

Этот внешний аутентификатор обеспечивает доступ пользователям и группам пользователей, принадлежащим Active Directory, к виртуальным рабочим столам или приложениям.

![Рис. 15](../../.gitbook/assets/uds-15.png)

Минимальные параметры для настройки в аутентификаторе Active Directory:

* имя (Name) – имя аутентификатора;
* приоритет (Priority) – приоритет аутентификатора. Чем ниже значение параметра, тем выше аутентификатор будет отображаться в списке аутентификаторов, доступных в окне доступа пользователя. Допускаются отрицательные значения;
* метка (Label) – метка, позволяет получать прямой доступ к странице входа с использованием данного аутентификатора без необходимости выбора, используя URL вида: VDI Server / login / label (например, https: // HOSTVM VDI Server / login / AD);
* хост (Host) – IP-адрес или имя сервера AD;
* порт (Port) – порт подключения к серверу AD (обычно 389, или 636 при использовании SSL);
* использовать SSL (Use SSL) – если установлено значение «Yes», используется SSL-соединение с сервером AD;
* пользователь (Ldap user) – пользователь с правами чтения AD в формате: user@domain;
* пароль (Password) – пароль пользователя;
* тайм-аут (Timeout) – тайм-аут соединения с аутентификатором;
* Base – базовая запись поиска в AD (например dc=example, dc=com).

![Рис. 16](../../.gitbook/assets/uds-16.png)

Нажав кнопку «Test», можно проверить, правильно ли настроено соединение с AD.

### Внутренняя база данных (Internal Database)

В средах, где нет внешнего аутентификатора, можно использовать аутентификатор «Internal Database». Этот аутентификатор позволяет вручную создавать пользователей и группы для доступа к различным службам рабочего стола и виртуальным приложениям, предоставляемым платформой HOSTVM VDI.

Все данные пользователей и групп хранятся в базе данных, к которой подключен сервер HOSTVM VDI.

В «Internal Database» должны быть настроены минимальные параметры.

**Основные параметры:**

* имя (Name) – имя аутентификатора;
* приоритет (Priority) – приоритет аутентификатора. Чем ниже значение этого параметра, тем выше аутентификатор будет отображаться в списке аутентификаторов, доступных в окне доступа пользователя. Допускаются отрицательные значения параметра;
* метка (Label) – включает прямую проверку в этом аутентификаторе, это позволяет пользователю выполнять проверку с помощью указанного аутентификатора, хотя в среде UDS есть больше аутентификаторов. Для этого нужно получить доступ к экрану «входа в систему» HOSTVM VDI в следующем формате: HOSTVM VDI Server / uds / page / login / label (например: https: // VDIServer / uds / page / login / int1);

**Дополнительные параметры:**

* Different user for each host – параметр позволяет подключаться к виртуальным рабочим столам с помощью одного и того же пользователя, добавляя приставку к имени существующего пользователя во время подключения к виртуальному рабочему столу. Приставка – это IP-адрес клиента подключения или его DNS-имя. Новое созданное имя пользователя имеет следующую структуру: IP клиента-пользователь подключения;
* Reverse DNS – аналогично предыдущему параметру, но корень, добавленный к пользователю, является DNS-именем клиента подключения. Требуется правильное разрешение DNS, в противном случае будет использоваться IP-адрес. Созданный пользователь имеет следующую структуру: пользователь-имя\_клиента\_подключения;
* Accept proxy – этот параметр должен быть включен, если есть компонент для доступа к серверу HOSTVM VDI, например, балансировщик нагрузки. По умолчанию HOSTVM VDI автоматически определяет IP-адрес клиента подключения. В средах, где настроены балансировщики нагрузки или другие подобные элементы, это обнаружение не выполняется правильно, поскольку обнаруженный IP-адрес соответствует этим балансировщикам. Включение данной опции обеспечит правильное определение IP. В средах, где используется опция «Different user for each host» и есть балансировщики нагрузки, необходимо включить эту опцию;
* Visible – если этот параметр отключен, аутентификатор не будет отображаться как доступный на странице входа в брокер.

### Настройка пользователей и групп



![карт](../../.gitbook/assets/uds-17.png)

****

![карт](../../.gitbook/assets/uds-18.png)

****

![карт](../../.gitbook/assets/uds-19.png)

****

![карт](../../.gitbook/assets/uds-20.png)

****

![карт](../../.gitbook/assets/uds-21.png)

****

### Настройка менеджеров ОС



![карт](../../.gitbook/assets/uds-22.png)

****

### Настройка Linux OS Manager

Менеджер Linux OS предназначен для управления виртуальными рабочими столами на базе Linux-систем.

Минимально необходимые параметры настройки менеджера:

* Name: имя менеджера ОС;
* Logout action: выполняемое при завершении сеанса пользователя действие. Доступные варианты: Keep service assigned (виртуальный рабочий стол остается зарезервированным за пользователем, и при следующем обращении предоставляется ему же), Remove service (виртуальный рабочий стол удаляется, при следующем обращении назначается новый);
* Max. Idle time: максимальное время неактивности пользователя, по достижении которого выполняется автоматический выход из системы. Применяется только при выборе опции Logout action: Remove service.

![карт](../../.gitbook/assets/uds-23.png)

**Рис. 23**

### Настройка Windows Basic OS Manager

Менеджер Windows Basic OS предназначен для управления виртуальными рабочими столами на базе Windows-систем, не являющихся членами домена.

Минимально необходимые параметры настройки менеджера:

* Name: имя менеджера ОС;
* Logout action: выполняемое при завершении сеанса пользователя действие. Доступные варианты: Keep service assigned (виртуальный рабочий стол остается зарезервированным за пользователем, и при следующем обращении предоставляется ему же), Remove service (виртуальный рабочий стол удаляется, при следующем обращении назначается новый);
* Max. Idle time: максимальное время неактивности пользователя, по достижении которого выполняется автоматический выход из системы. Применяется только при выборе опции Logout action: Remove service.

![карт](../../.gitbook/assets/uds-24.png)

**Рис. 24**

## Настройка транспортов подключения



![карт](../../.gitbook/assets/uds-25.png)

**Рис. 25**

![карт](../../.gitbook/assets/uds-26.png)

**Рис. 26**



![карт](../../.gitbook/assets/uds-27.png)

**Рис. 27**

### Прямой транспорт SPICE



![карт](../../.gitbook/assets/uds-28.png)

****

![карт](../../.gitbook/assets/uds-29.png)

****

![карт](../../.gitbook/assets/uds-30.png)

**Рис. 30**

## Настройка пула сервисов.



![карт](../../.gitbook/assets/uds-31.png)

****

![карт](../../.gitbook/assets/uds-32.png)

****

![карт](../../.gitbook/assets/uds-33.png)

****

![карт](../../.gitbook/assets/uds-34.png)

****

![карт](../../.gitbook/assets/uds-35.png)

****

![карт](../../.gitbook/assets/uds-36.png)

**Рис. 36**
