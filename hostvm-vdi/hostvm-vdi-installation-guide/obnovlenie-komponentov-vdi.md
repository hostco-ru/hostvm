# Обновление компонентов VDI

## HOSTVM VDI брокер (Переход на новую сборку в рамках версии 3.0)

### Процедура для одного сервера со встроенной БД

Обновление осуществляется путем переноса базы и настроек на новую версию ВМ брокера. В момент переноса портал и сервисы пользователей будут недоступны.

Остановить сервисы в консоли ВМ брокера VDI:

```
# systemctl stop uds apache2
```

Сделать резервную копию БД:

```
# mysqldump -u root udsdb > backup.sql
```

Скопировать бэкап на внешний ресурс.

Сохранить сетевые настройки из файла `/etc/network/interfaces` и имя машины, если их планируется переносить на новую ВМ.

Выключить ВМ.

Импортировать новую версию ВМ брокера согласно статье ["Установка HOSTVM VDI Broker"](https://kb.pvhostvm.ru/hostvm-vdi/hostvm-vdi-installation-guide/hostvm-vdi-ova-install), до момента авторизации в веб-интерфейсе управления.

Настройки сети и имя машины задать от старой версии ВМ брокера, если применимо.

После завершения базовой настройки на ВМ брокера скопировать с внешнего ресурса и развернуть резервную копию.

```
# systemctl stop uds apache2
# cat backup.sql | /usr/bin/mysql -u root udsdb
# systemctl start uds apache2
```

После запуска служб портал, конфигурация и сервисы пользователей будут доступны через веб-интерфейс брокера.

## Обновление брокера VDI на РЕД ОС

Обновление осуществляется путём установки пакета hostvm-vdi новой версии.

Скачать и разархивировать пакет из личного кабинета:

```
tar -xvf ./hostvm-vdi<номер версии>-<номер сборки>.rpm.tar.bz2
```

Установить скачанный пакет:

```
sudo yum install ./hostvm-vdi<номер версии>x86_64.rpm
```

## HOSTVM VDI туннелер

### Процедура для одного сервера

Обновление осуществляется путем разворачивания новой версии туннелера и подключения к VDI брокеру согласно статье ["Установка HOSTVM VDI Tunneler"](https://kb.pvhostvm.ru/hostvm-vdi/hostvm-vdi-installation-guide/tunneler-appliance-deploy).

При задании сетевых настроек, идентичных старой версии туннелера, дополнительной конфигурации со стороны брокера не требуется.

Если будет использоваться другой IP адрес, необходимо создать соответствующие транспорты для туннельных подключений в панели управления брокера, с использованием нового адреса.
