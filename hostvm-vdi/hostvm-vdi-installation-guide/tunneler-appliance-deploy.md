# Установка HOSTVM VDI Tunneler

## Развертывание HOSTVM VDI Tunneler версии 3.0

### Требования к конфигурации виртуальной машины

* Hard drive: 10 GB
* Memory: 2 G
* CPU: 2 vCPU
* Network: 1 vNIC

### Импорт виртуальной машины

* Скачать образ машины `HOSTVM-VDI/hostvm-tunneler.tar.bz2` из каталога загрузок HOSTVM.
* Загрузить данный файл на один из хостов виртуализации к HOSTVM с помощью scp или других средств.
* Распаковать: `tar xjvf hostvm-tunneler.tar.bz2`&#x20;
* Авторизоваться в веб-интерфейсе виртуализации, перейти в пункт **Compute - Virtual Machines**.
* Нажать на иконку из трех вертикальных точек в правом верхнем углу интерфейса и выбрать пункт **Import**.
* Выбрать **Source: "Virtual Appliance(OVA)"** и указать абсолютный путь директории с файлом на хосте, нажать кнопку Load для поиска образа.
* Выбрать нужный образ, нажать на стрелочку для помещения его в список ВМ для импорта и нажать кнпоку **Next**.
* В появившемся окне указать нужное хранилище для ВМ и кластер. Также нужно выбрать строчку с именем ВМ, перейти на вкладку **Network Interfaces** и указать нужную сеть для данной ВМ.
* После этого с помощью кнопки **OK** запустить импорт OVA и дождаться окончания импорта.
* Запустить полученную ВМ.

### Настройка сети

В случае получения IP адрес по DHCP данный раздел настройки можно пропустить.

Если требуется настройка статического адреса, то нужно подключиться к ВМ через spice консоль: `Compute>Virtual machines>выбрать машину>нажать кнопку Console`

После подключения внести нужные параметры в файл `/etc/network/interfaces`.

Пример настройки:

```
allow-hotplug eth0
iface eth0 inet static
    address 10.1.1.2
    netmask 24
    gateway 10.1.1.1
```

Указать адреса DNS в `/etc/resolv.conf`

Перезапустить виртуальную машину для применения настроек:

```bash
reboot
```

### Настройка сертификатов

Для подключения к брокеру VDI по протоколу HTTPS требуется наличие установленного действительного сертификата на ВМ брокера. При необходимости, добавьте CA сертификат на ВМ туннелера VDI, перед запуском графического мастера установки.

```bash
cp cert-bundle.crt /usr/local/share/ca-certificates/
update-ca-certificates
```

### Мастер установки HOSTVM VDI Tunneler

После настройки параметров сети и перезапуска машины, мастер установки будет доступен через браузер по адресу: `http://<ip_адрес_ВМ_туннелера>:9900`

![](<../../.gitbook/assets/image (51).png>)

После открытия веб-страницы конфигуратора выполните следующие действия:

* Выберите язык установки.
* Проверьте параметры: имя сервера, домен, настройки сети и dns.\
  Если параметры сети не требуют корректировки, выберите в выпадающем списке опцию “Skip network config (leave it as is)”.\
  Если корректировка требуется, оставьте в выпадающем списке опцию "Configure network" и внесите изменения. В случае смены ip адреса установщик автоматически перенаправит пользователя на новый, для продолжения установки.

![](<../../.gitbook/assets/image (47).png>)

* Проверьте и подтвердите настройки, дождитесь их применения.
* Настройте раскладку клавиатуры для ОС, часовой пояс и ntp сервер (необязательно).

![](<../../.gitbook/assets/image (45).png>)

* Задайте пароль локального пользователя root для ОС сервера туннелирования.

![](<../../.gitbook/assets/image (34).png>)

* Задайте настройки подключения к vdi брокеру, указав его fqdn или ip. Использование подключения "HTTPS (Secure Connection)” возможно в случае наличия действительного сертификата на брокере, иначе используйте подключение “HTTP”.

![](<../../.gitbook/assets/image (41).png>)

* Загрузите https сертификаты для сервера туннелирования (необязательно), либо пропустите шаг, нажав next.

![](<../../.gitbook/assets/image (44).png>)

* Завершите настройку перезагрузкой сервера, и закройте страницу установщика. После перезагрузки сервер будет готов к работе.

![](<../../.gitbook/assets/image (42).png>)

При необходимости запустить конфигуратор заново, авторизуйтесь на сервере под пользователем root и паролем, указанным в шаге 5, затем запустите команду:

```bash
uds setup
```

После выполнения команды конфигуратор будет доступен через браузер по адресу: `http://<ip_адрес_ВМ_туннелера>:9900`.

### Настройка транспорта в панели управления HOSTVM VDI

При настройке туннелированных подключений (транспортов) в панели управления брокера HOSTVM VDI, в качестве параметра tunnel server на вкладке Tunnel настроек транспорта указывайте адрес настроенной ВМ туннелера в формате `адрес:порт`, где адрес - IP или FQDN туннелера, порт - порт подключения, по умолчанию 443.

![](<../../.gitbook/assets/image (46).png>)
