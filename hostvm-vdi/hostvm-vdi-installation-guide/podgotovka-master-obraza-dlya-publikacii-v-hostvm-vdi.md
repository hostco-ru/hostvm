# Подготовка мастер-образа для публикации в HOSTVM VDI

### VDI Actor

Для управления публикацией виртуальных рабочих столов на основе технологии копирования, в базовый (“золотой”) образ гостевой операционной системы Windows или Linux устанавливается пакет VDI Actor.

VDI Actor доступен для загрузки в веб-интерфейсе брокера HOSTVM VDI из-под учетной записи с правами администратора.&#x20;

![](<../../.gitbook/assets/image (1).png>)

Выберите **«Загрузки»** в меню пользователя.

![](<../../.gitbook/assets/image (2).png>)

В браузере отобразится перечень версий VDI Actor, доступных для загрузки. Выберите нужный вариант в соответствии с типом операционной системы, используемой для базового (“золотого”) образа.

![](<../../.gitbook/assets/image (4).png>)

Выберите версию VDI Actor, соответствующую типу и версии операционной системы в базовом образе или на сервере приложений, на котором будут развернуты службы рабочего стола:&#x20;

* udsactor\_3.0.0\_all.deb: для базового образа машин Linux на основе Debian, а также Ubuntu, Xubuntu и т.д. (требует python версии не ниже 3.6);
* udsactor-3.0.0-1.noarch.rpm: для базового образа машин Linux на основе Red Hat, а также CentOS, Fedora и т.д. (требует python версии не ниже 3.6);
* udsactor-opensuse-3.0.0-1.noarch.rpm: для базового образа машин Linux на основе Suse, а также OpenSuse и т.д. (требует python версии не ниже 3.6);
* udsactor-2.2.0\_legacy.deb: версия 2.2 для базового образа машин Linux на основе Debian, а также Ubuntu, Xubuntu и т.д. (требует python версии 2.7);
* udsactor-unmanaged\_3.0.0\_all.deb: для управления сеансами машин на основе Debian, а также Ubuntu, Xubuntu и т.д., подключенных как сервис-провайдер «Static IP Machines Provider»;
* UDSActorSetup-3.0.0.exe: для базового образа машин Windows;
* UDSActorUnmanagedSetup-3.0.0.exe: для управления сеансами компьютеров Windows, подключенных как сервис-провайдер «Static IP Machines Provider».

### Подготовка Windows ВМ в качестве рабочих станций

Для управления жизненным циклом виртуальных рабочих столов на основе технологии копирования, в базовый (“золотой”) образ гостевой операционной системы Windows устанавливается пакет VDI Actor: `UDSActorSetup-3.0.0.exe`.

**Примечание: **перед установкой необходимо получить IP-адрес или FQDN брокера HOSTVM VDI, учетные данные пользователя с правами администратора и как минимум один аутентификатор, зарегистрированный на этом брокере.

После скачивания дистрибутива Actor для ОС Windows и его загрузки на машину-шаблон (базовый образ), запустите его для начала процесса установки.&#x20;

![](<../../.gitbook/assets/image (5).png>)

После этого:

1. Выберите язык установщика;
2. Укажите путь установки Actor;
3. Нажмите «Установить» («Install»), чтобы продолжить установку;
4. После завершения установки перейдите к настройке Actor.

![](<../../.gitbook/assets/image (6).png>)

![](<../../.gitbook/assets/image (9).png>)

На вкладке «Сервер UDS» («UDS Server») необходимо зарегистрировать Actor в брокере HOSTVM VDI, указав следующие параметры:

* проверка SSL (SSL Validation) – тип проверки безопасности при соединении с брокером HOSTVM VDI;
* сервер UDS (UDS Server) – имя или IP-адрес брокера HOSTVM VDI;
*   аутентификатор (authenticator) – аутентификатор брокера, которому принадлежит указываемый ниже пользователь с правами администратора, для регистрации Actor.

    Для отображения перечня аутентификаторов должна быть связь с брокером HOSTVM VDI. Аутентификатор «Администрирование» («Administration») соответствует суперпользователю (root), создаваемому при первоначальной настройке брокера. Другие типы аутентификаторов будут присутствовать в списке, если они были настроены в брокере;
* имя пользователя (username) – имя пользователя с правами администратора в среде HOSTVM VDI (должен принадлежать ранее выбранному аутентификатору);
* пароль (password) – пароль пользователя.

Как только параметры будут указаны, следует нажать кнопку «Зарегистрироваться в UDS» («Register with UDS»).

Чтобы проверить правильность подключения к серверу HOSTVM VDI, необходимо нажать кнопку «Проверить конфигурацию» («Test configuration»).

![](<../../.gitbook/assets/image (23).png>)

На вкладке «Дополнительно» («Advanced») можно указать указать следующие дополнительные параметры:

*   Preconnect – сценарий, запускаемый непосредственно перед подключением пользователя к виртуальному рабочему столу.

    Брокер HOSTVM VDI автоматически передаст следующие параметры, которые можно использовать в сценарии: имя пользователя, протокол (rdp, nx, pcoip ...), IP адрес клиента (SRC IP), имя клиента (SRC Host);
*   Runonce – сценарий, который запускается только один раз до того, как Actor применит свои настройки.

    После выполнения он удаляется из конфигурации. Параметры могут быть переданы прямо в него. Выполняемый сценарий необходимо завершить, перезапустив виртуальный рабочий стол. В противном случае рабочий стол никогда не применит настройки Actor, не позволяя ему достичь состояния «Действительный» («Valid») в панели управления брокера HOSTVM VDI;
*   Postconfig – сценарий, который выполняется, когда Actor завершает базовую настройку. Параметры могут быть переданы прямо в него.

    Сценарий запускается только один раз, но, в отличие от «Runonce», перезапускать виртуальный рабочий стол не требуется. Этот сценарий полезен для добавления некоторых собственных элементов в конфигурацию, созданную Actor, например, копирование файлов из локальной сети, выполнение скриптов конфигурации и т.д.;
* Log Level – уровень логирования для отображения в файлах журнала Actor. Эти файлы журналов (udsactor.log) расположены в следующих местах: `%temp%` (путь к временным файлам пользователя) и `C:\Windows\Temp` (путь к временным файлам ОС).

После установки и настройки Actor машина-шаблон (“золотой” образ) должна быть выключена, и будет доступна для использования брокером HOSTVM VDI для развертывания виртуальных рабочих столов на основе технологии клонирования.&#x20;

**Примечание: **в дополнение к установке Actor на уровне ОС необходимо обеспечить возможность работы протокола подключения, который в дальнейшем будет использоваться для подключения к созданным рабочим столам (например, включить возможность удаленного доступа к рабочему столу (RDP), установить клиент PCoIP и т.д.).

### Подготовка Linux ВМ в качестве рабочих станций

Для управления жизненным циклом виртуальных рабочих столов на основе технологии копирования, в базовый (“золотой”) образ гостевой операционной системы Linux устанавливается пакет VDI Actor.

#### Установка и настройка VDI Actor версии 2.2

**Примечание: **перед установкой необходимо получить IP-адрес или FQDN брокера HOSTVM VDI.

После загрузки на машину-шаблон (“золотой” образ) требуемой версии дистрибутива Actor (в соответствии с типом используемой операционной системы) можно приступать к установке:

1.  Перейдите в директорию, куда был загружен дистрибутив Actor и запустите установку (пример для машины с Debian):&#x20;

    `dpkg -i udsactor_2.2.0_all.deb`

    Установка может завершиться с ошибками при наличии неразрешенных зависимостей. Для решения необходимо выполнить следующие команды:

    `apt-get update && apt-get install -f`
2. После процессе установки нужно сконфигурировать Actor (в дальнейшем эта возможно сделать также в графической оболочке, выбрав в списке приложений и запустив Uds Actor Configuration) внесением следующих далее параметров;
3. Ввести IP-адрес брокера HOSTVM VDI;
4. Выбрать тип подключения Actor к брокеру;
5. Также нужно указать «UDS Master Key», который был создан при установке брокера. Для того, чтобы получить этот ключ, нужно зайти в панель управления брокера HOSTVM VDI (с использованием учетной записи с правами администратора), перейти в меню в Tools -> Configuration на вкладку «Security» и скопировать ключ из поля «Master Key»;
6. Полученный ключ необходимо вставить в мастер настройки Actor;
7. После ввода всех необходимых данных выполните проверку подключения Actor к серверу HOSTVM VDI посредством нажатия кнопки «Test parameters»;

![п.3 Ввести IP-адрес брокера HOSTVM VDI](<../../.gitbook/assets/image (25).png>)

![п.4 Выбрать тип подключения Actor к брокеру](<../../.gitbook/assets/image (18).png>)

![п.5 Получить Master Key](<../../.gitbook/assets/image (19).png>)

![п.6 Вставить полученный ключ](<../../.gitbook/assets/image (21).png>)

![п.7 Проверка подключения](<../../.gitbook/assets/image (22).png>)

После установки и настройки Actor машина-шаблон (“золотой” образ) должна быть выключена, и будет доступна для использования брокером HOSTVM VDI для развертывания виртуальных рабочих столов на основе технологии клонирования.

#### Установка и настройка VDI Actor версии 3.0

**Примечание: **перед установкой необходимо получить IP-адрес или FQDN брокера HOSTVM VDI, учетные данные пользователя с правами администратора и как минимум один аутентификатор, зарегистрированный на этом брокере.

После загрузки на машину-шаблон (“золотой” образ) требуемой версии дистрибутива Actor (в соответствии с типом используемой операционной системы) можно приступать к установке.

Рекомендуется выполнять установку пакета Actor через командную консоль.

При получении уведомления об ошибке из-за отсутствия зависимостей следует установить их.

После установки необходимых зависимостей следует запустить конфигурацию Actor.

На вкладке «Сервер UDS» («UDS Server») необходимо зарегистрировать Actor в брокере VDI, указав следующие параметры:

* проверка SSL (SSL Validation) – тип проверки безопасности при соединении с брокером HOSTVM VDI;
* сервер UDS (UDS Server) – имя или IP-адрес брокера HOSTVM VDI;
*   аутентификатор (authenticator) – аутентификатор брокера, которому принадлежит указываемый ниже пользователь с правами администратора, для регистрации Actor.

    Для отображения перечня аутентификаторов должна быть связь с брокером HOSTVM VDI. Аутентификатор «Администрирование» («Administration») соответствует суперпользователю (root), создаваемому при первоначальной настройке брокера. Другие типы аутентификаторов будут присутствовать в списке, если они были настроены в брокере;
* имя пользователя (username) – имя пользователя с правами администратора в среде HOSTVM VDI (должен принадлежать ранее выбранному аутентификатору);
* пароль (password) – пароль пользователя.

Как только параметры будут указаны, следует нажать кнопку «Зарегистрироваться в UDS» («Register with UDS»).

Чтобы проверить правильность подключения к брокеру HOSTVM VDI, необходимо нажать кнопку «Проверить конфигурацию» («Test configuration»).

На вкладке «Дополнительно» («Advanced») можно указать следующие дополнительные параметры:

*   Preconnect – сценарий, запускаемый непосредственно перед подключением пользователя к виртуальному рабочему столу.

    Брокер HOSTVM VDI автоматически передаст следующие параметры, которые можно использовать в сценарии: имя пользователя, протокол (rdp, nx, pcoip ...), IP адрес клиента (SRC IP), имя клиента (SRC Host);
*   Runonce – сценарий, который запускается только один раз до того, как Actor применит свои настройки.

    После выполнения он удаляется из конфигурации. Параметры могут быть переданы прямо в него. Выполняемый сценарий необходимо завершить, перезапустив виртуальный рабочий стол. В противном случае рабочий стол никогда не применит настройки Actor, не позволяя ему достичь состояния «Действительный» («Valid») в панели управления брокера HOSTVM VDI;
*   Postconfig – сценарий, который выполняется, когда Actor завершает базовую настройку. Параметры могут быть переданы прямо в него.

    Сценарий запускается только один раз, но, в отличие от «Runonce», перезапускать виртуальный рабочий стол не требуется. Этот сценарий полезен для добавления некоторых собственных элементов в конфигурацию, созданную Actor, например, копирование файлов из локальной сети, выполнение скриптов конфигурации и т.д.;
* Log Level – уровень логирования для отображения в файлах журнала Actor. Эти файлы журналов (udsactor.log) расположены по пути: `/var/log/`

После установки и настройки Actor машина-шаблон (“золотой” образ) должна быть выключена, и будет доступна для использования брокером HOSTVM VDI для развертывания виртуальных рабочих столов на основе технологии клонирования.

**Примечание: **в дополнение к установке Actor на уровне ОС необходимо обеспечить возможность работы протокола подключения, который в дальнейшем будет использоваться для подключения к созданным рабочим столам (например, установка и настройка XRDP, X2Go Server и т.д.).

### Особенности подготовки ВМ с ОС ALT-Linux 8.3K в качестве рабочих станций

В Alt Linux стандартный пакет `udsactor-2.2.0-1.noarch.rpm` не устанавливается из-за неразрешимых зависимостей.

Нужно поставить зависимости вручную:

`apt-get install python-module-PyQt4 python-module-requests python-module-six`

И установить актор из пакета для alt linux:

`rpm -Uvh udsactor-2.2.0-AltLinux.noarch.rpm`

[https://cloud.hostco.ru/s/XEeDF2J77WCbFEQ](https://cloud.hostco.ru/s/XEeDF2J77WCbFEQ)

Также после установки актор нужно настроить – указать адрес брокера HOSTVM VDI и Master key от него (Панель управления  – Конфигурация – Master Key)

Нажатие Test parameters должно проходить успешно.

![](<../../.gitbook/assets/image (28).png>)
