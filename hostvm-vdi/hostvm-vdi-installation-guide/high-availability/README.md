# Конфигурация высокой доступности

HOSTVM VDI поддерживает конфигурацию входящих в состав компонентов в режиме высокой доступности. Такой режим работы позволяет обеспечить доступность сервисов в случае отказа оборудования или одного из компонентов системы.

Для работы в режиме высокой доступности, помимо конфигурации нескольких экземпляров брокера и шлюза HOSTVM VDI потребуется настроить репликацию базы данных брокера и развернуть балансировщик нагрузки для управления соединениями между компонентами системы. Далее в документе приведен порядок действий для конфигурации высокой доступности.

## **Конфигурация базы данных** <a href="#db" id="db"></a>

Разверните два экземпляра виртуальной машины сервера БД HOSTVM VDI:

* [Установка и настройка выделенного сервера БД](../vdi-db/)

Настройте репликацию между серверами. Для этого воспользуйтесь одной из следующих инструкций, в зависимости от выбранной СУБД при установке и настройке серверов:

* [Настройка репликации БД (MariaDB)](db-replication/mariadb/)
* [Настройка репликации БД (PostgreSQL)](db-replication/postgresql.md)

{% hint style="info" %}
Если вам требуется настроить кластер PostgreSQL, ознакомьтесь с документом [Настройка кластера PostgreSQL](db-cluster-postgresql.md).
{% endhint %}

## **Конфигурация балансировщика** <a href="#load-balancer" id="load-balancer"></a>

Разверните два экземпляра виртуальной машины балансировщика HOSTVM VDI:

* [Установка и настройка балансировщика HAProxy](haproxy.md)

## **Конфигурация брокера** <a href="#vdi-broker" id="vdi-broker"></a>

Разверните два экземпляра виртуальной машины брокера HOSTVM VDI:

* [Установка HOSTVM VDI Broker](../hostvm-vdi-ova-install/)

На одной из машин запустите мастер установки для подключения к внешней базе данных (для настройки используйте данные активного сервера БД):

* [Настройка брокера VDI для использования выделенного сервера БД](../vdi-db/broker-config.md)

После завершения работы мастера скопируйте файл конфигурации брокера `/var/server/server/settings.py` на вторую машину и перезапустите ее. Запускать мастер установки на втором брокере повторно не требуется.

## **Конфигурация шлюза** <a href="#vdi-tunneler" id="vdi-tunneler"></a>

Разверните два экземпляра виртуальной машины шлюза HOSTVM VDI:

* [Установка HOSTVM VDI Tunneler](../tunneler-appliance-deploy.md)

Параметры в мастере установки идентичны стандартному развертыванию, за исключением адреса подключения к брокеру HOSTVM VDI. Здесь необходимо указать виртуальный IP-адрес балансировщика.

## **SSL сертификаты** <a href="#ssl-certificates" id="ssl-certificates"></a>

Выполните [настройку SSL сертификатов для конфигурации высокой доступности](ssl-certificates.md).

