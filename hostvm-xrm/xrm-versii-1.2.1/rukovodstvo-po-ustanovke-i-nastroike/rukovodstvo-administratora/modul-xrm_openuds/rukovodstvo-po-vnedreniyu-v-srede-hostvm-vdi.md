---
description: >-
  Для автоматизации аварийного восстановления VDI на основе OpenUDS с помощью
  модуля xrm_OpenUDS в составе X Recovery Manager (XRM).
---

# Руководство по внедрению в среде HOSTVM VDI

HOSTVM VDI позволяет управлять широким спектром компонентов пользовательской инфраструктуры, таких как выделенные виртуальные машины, терминальные сессии, терминальные приложений, публикация физических ПК для удаленной работы.



<figure><img src="../../../../../.gitbook/assets/image (87).png" alt=""><figcaption><p>HOSTVM VDI</p></figcaption></figure>

Модуль xrm\_OpenUDS в составе X Recovery Manager (XRM) предназначен для автоматизации аварийного восстановления пулов ресурсов и конфигурации среды на основе HOSTVM VDI и иных решений, построенных на основе открытой платформы OpenUDS.\


<figure><img src="../../../../../.gitbook/assets/image (89).png" alt=""><figcaption><p>Рабочее окно модуля xrm_OpenUDS</p></figcaption></figure>

Использование XRM совместно с VDI наиболее полезно в ситуации построения комплексной инфраструктуры, которую необходимо защитить от крупных сбоев и аварийных ситуаций, при этом обеспечиваются следующие возможности:

1. **Обеспечение непрерывной работы**: инфраструктура VDI играет критическую роль в бизнес-процессах многих организаций. XRM обеспечивает постоянную работу пользователей путем автоматизированного восстановления ресурсов VDI в случае сбоев, аварий или других непредвиденных ситуаций.
2. **Минимизация времени простоя**: аварийные ситуации могут привести к простою операций и серьезным финансовым потерям. XRM позволяет быстро восстановить работоспособность системы управления средой VDI по заранее созданному плану восстановления, что сокращает время простоя и минимизирует влияние сбоев на бизнес-процессы.
3. **Автоматизация восстановления**: XRM выполняет аварийное восстановление по заранее созданному и проверенному сценарию восстановления, что делает инфраструктуру более надежной и уменьшает вероятность человеческих ошибок при выполнении восстановительных действий, позволяет минимизировать окно простоя в случае аварии и сэкономить требуемое кол-во ресурсов администраторов для сопровождения VDI.

### Рассмотрим последовательность шагов для настройки

Для демонстрации процесса аварийного восстановления рассмотрим сценарий аварийной ситуации, которая могла бы возникнуть на основной площадке организации.

Предположим, что у нас есть две независимые инсталляции HOSTVM VDI на разных физических серверах: vdi-primary.pvhostvm.ru (Primary Broker) и vdi-secondary.pvhostvm.ru (Secondary Broker).

Основной брокер (Primary Broker) управляет доступом пользователей к активным сервисам, несущим бизнес-нагрузку организации. Однако, несмотря на предпринятые меры предосторожности, иногда возникают аварийные ситуации, такие как отказы оборудования, сетевые проблемы или другие непредвиденные события, которые могут привести к недоступности основного брокера.

В таких критических сценариях, необходимо быстро и эффективно восстановить доступ к сервисам организации. Для этого используется резервный брокер (Secondary Broker), предварительно подготовленный к принятию ресурсов VDI с основного в случае аварии.

В данном контексте мы будем рассматривать сценарий, в котором возникла аварийная ситуация на площадке с основным брокером (vdi-primary.pvhostvm.ru), и нам необходимо выполнить аварийное восстановление на резервный брокер (vdi-secondary.pvhostvm.ru). Разберем пошаговый план и действия, необходимые для успешного восстановления доступа к сервисам, используя модуль **xrm\_OpenUDS**, на примере нашего тестового стенда.

#### Описание стенда:

Две независимые инсталляции HOSTVM VDI Broker на разных физических серверах. Основной брокер управляет доступом к сервису Windows Static Multiple.\


| Параметр       | Основной брокер         | Резервный брокер          |
| -------------- | ----------------------- | ------------------------- |
| Адрес брокера  | vdi-primary.pvhostvm.ru | vdi-secondary.pvhostvm.ru |
| Сервис-пул     | Windows Static Multiple | -                         |
| Учётная запись | user                    | root                      |
| Аутентификатор | ActiveDirectory         | admin                     |



#### Основной брокер (Primary Broker):

* **vdi-primary.pvhostvm.ru** – FQDN основного брокера, управляющего доступом к сервису Windows Static Multiple, с которого генерируем план восстановления;
* **Windows Static Multiple** –  сервис-пул на основе провайдера машин со статическим IP;
* **user** –  учётная запись с основного брокера;
* **ActiveDirectory** –  аутентификатор Active Directory ;
* **RDP** –  транспорт для подключения к сервису Windows Static Multiple типа Direct RDP.

<figure><img src="../../../../../.gitbook/assets/image (68).png" alt=""><figcaption><p>Windows Static Multiple –  сервис-пул на основе провайдера машин со статическим IP</p></figcaption></figure>

<figure><img src="../../../../../.gitbook/assets/image (69).png" alt=""><figcaption><p>RDP - привязанный транспорт к сервис-пулу Windows Static Multiple</p></figcaption></figure>

<figure><img src="../../../../../.gitbook/assets/image (70).png" alt=""><figcaption><p>DemoUsers@ad - группа из аутентификатора Active Directory, привязанная к сервис-пулу Windows Static Multiple</p></figcaption></figure>

#### Резервная площадка (Secondary Site):

* **vdi-secondary.pvhostvm.ru** – резервный брокер, предварительно подготовленный к принятию ресурсов VDI с основного в случае аварии;
* **root** – встроенная учётная запись администратора;
* **admin** – встроенный аутентификатор.

<figure><img src="../../../../../.gitbook/assets/image (71).png" alt=""><figcaption><p>Панель управления резервного брокера</p></figcaption></figure>

### Шаг 1. Настройка раздела "ПАРАМЕТРЫ" модуля xrm\_OpenUDS для создания, удаления и запуска плана восстановления.

Войти в XRM, используя[ ](https://kb.x-rm.ru/dokumentaciya/dokumentaciya/xrm-versiya-1.2/rukovodstvo-polzovatelya)[Руководство пользователя](../../../rukovodstvo-polzovatelya.md). На верхней панели в меню навигации выбрать **МОДУЛИ**, слева в разделе **INSTALLED** выбрать модуль **xrm\_OpenUDS**

<figure><img src="../../../../../.gitbook/assets/image (72).png" alt=""><figcaption><p>XRM, секция ПАРАМЕТРЫ модуля xrm_OpenUDS</p></figcaption></figure>

Cправа в секции **ПАРАМЕТРЫ** необходимо настроить следующие параметры:

{% hint style="info" %}
С подробным описанием параметров можно ознакомиться в главе [Начальная настройка](nachalnaya-nastroika.md)
{% endhint %}

В нашем примере секция CONFIG модуля «xrm\_OpenUDS» выглядит следующим образом.

<figure><img src="../../../../../.gitbook/assets/image (74).png" alt=""><figcaption><p>XRM, заполненная секция ПАРАМЕТРЫ модуля xrm_OpenUDS</p></figcaption></figure>

**Конфигурация модуля xrm\_OpenUDS завершена.**

### Шаг 2. Создание, удаление, и запуск планов восстановления.

Войти в XRM, используя[ ](https://kb.x-rm.ru/dokumentaciya/dokumentaciya/xrm-versiya-1.2/rukovodstvo-polzovatelya)[Руководство пользователя](../../../rukovodstvo-polzovatelya.md). На верхней панели в меню навигации выбрать **ДЕЙСТВИЯ**, слева развернуть раздел **XRM\_OPENUDS**.

XRM подключается к внешним системам с помощью расширяемого набора модулей, содержащих действия.

Действия - это набор сценариев доступных в составе модуля XRM. C помощью действий выполняются основные операции по управлению внешними системами, например, создание и запуск планов восстановления.&#x20;

**В модуле доступны следующие действия с планами восстановления:**

<table><thead><tr><th width="169">Действие</th><th>Описание</th><th data-hidden></th></tr></thead><tbody><tr><td>Generate (Generate recovery plan configuration)</td><td><p><strong>Генерация нового плана восстановления.</strong></p><p>При запуске действия необходимо указать уникальное наименование плана (по умолчанию - test).</p></td><td></td></tr><tr><td>Delete (Delete recovery plan configuration)</td><td><p><strong>Удаление существующего плана восстановления.</strong></p><p>При запуске действия необходимо указать наименование плана (по умолчанию - test).</p></td><td></td></tr><tr><td>Fail_Over (Perform disaster recovery to secondary Site)</td><td><p><strong>Запуск созданного с помощью действия Generate восстановления сервисов на резервной площадке.</strong></p><p>В рамках выполнения действия происходит перенос сервисов после сбоя на резервный брокер (Secondary Broker).</p><p>При запуске действия необходимо указать наименование плана (по умолчанию - test).</p></td><td></td></tr></tbody></table>

Для эффективного выполнения действия **Fail\_Over** (Выполнение процедуры аварийного восстановления на резервном брокере), необходимо сначала сгенерировать план восстановления – **Generate**.

#### Шаг 2.1. Генерация плана восстановления.

План определяет последовательность действий, необходимых для восстановления сервисов после аварии.

В меню навигации **XRM** выберите **ДЕЙСТВИЯ**, в левой части окна разверните раздел **XRM\_OPENUDS** и выберите опцию **Generate** (Generate recovery plan configuration).

<figure><img src="../../../../../.gitbook/assets/image (75).png" alt=""><figcaption><p>XRM, модуль XRM_OPENUDS, опция Generate</p></figcaption></figure>

В правой части окна укажите наименование плана восстановления **plan\_name**. Рекомендуется выбирать имя, которое ясно отражает суть аварийного восстановления, В нашем примере: **Plan\_Recovery**. После указания наименования плана восстановления, следует нажать кнопку **ЗАПУСТИТЬ**. После нажатия, в левом нижнем углу экрана отобразится всплывающее зеленое окно с надписью **Действие 'xrm\_openuds\_Generate' было успешно запущено.**

<figure><img src="../../../../../.gitbook/assets/image (76).png" alt=""><figcaption><p>Уведомление о запуске действия Generate</p></figcaption></figure>

Это сообщение указывает на то, что задача на выполнение операции генерации плана восстановления была успешно создана, и поставлена в очередь для выполнения.

Чтобы убедиться в успешном завершении операции по генерации плана восстановления, в меню навигации XRM выберите **ИСТОРИЯ** в этом разделе находится история операций и событий. В левой части окна найдите запись, связанную с выполнением операции по генерации плана восстановления (**xrm\_openuds.Generate**). Если процесс генерации плана восстановления все еще выполняется, в правой части окна отображается надпись СТАТУС **Выполняется**. Это информирует вас о том, что операция еще не завершилась, и ей требуется дополнительное время для выполнения. В этом случае, дождитесь завершения процесса генерации. После внимательно просмотрите статус этой записи. Если операция завершилась успешно, вы увидите зеленую галочку и зеленую надпись **Успешно**.

<figure><img src="../../../../../.gitbook/assets/image (77).png" alt=""><figcaption><p>Генерация плана восстановления успешно выполнена</p></figcaption></figure>

В случае неуспешного выполнения, отобразится статус **Ошибка**. Для просмотра логов хода операции в правой части, на сером блоке с названием **result**, перейдите по ссылке **expand**.

<figure><img src="../../../../../.gitbook/assets/image (79).png" alt=""><figcaption><p>Ошибка при генерации плана восстановления</p></figcaption></figure>

В нашей демонстрации процесса аварийного восстановления, генерация плана успешно выполнена!

После успешной генерации плана восстановления и сбора конфигурационных данных с основного брокера (Primary Broker) **vdi-primary.pvhostvm.ru** у нас теперь имеется готовый и эффективный план восстановления!

Когда аварийная ситуация произошла и основной брокер **vdi-primary.pvhostvm.ru** недоступен, резервный брокер **vdi-secondary.pvhostvm.ru** готов взять на себя роль основного для обеспечения непрерывности вашей инфраструктуры VDI. Давайте перейдем к следующему действию, которое заключается в запуске сервисов после сбоя на резервном брокере (Secondary Broker).

С помощью модуля аварийного восстановления, запустим процедуру **Fail\_Over** для переключения на резервный брокер.

#### Шаг 2.2. Процедура Fail\_Over. Восстановление работоспособности системы управления средой VDI. (Secondary Broker).

<figure><img src="../../../../../.gitbook/assets/image (80).png" alt=""><figcaption><p>"Пустой" резервный брокер vdi-secondary, Сервис-пулы</p></figcaption></figure>

В меню навигации **XRM** выберите **ДЕЙСТВИЯ**, в левой части окна разверните раздел **XRM\_OPENUDS** и выберите опцию **Fail\_Over** (Perform disaster recovery to secondary Site). В правой части окна укажите наименование плана восстановления **plan\_name**, который вы указывали в шаге 2.1. Генерация плана восстановления, в нашем примере: **Plan\_Recovery.** После указания имени плана восстановления, вам следует нажать кнопку **ЗАПУСТИТЬ**.

<figure><img src="../../../../../.gitbook/assets/image (81).png" alt=""><figcaption><p>XRM, модуль XRM_OPENUDS, процедура Fail_Over восстановление работоспособности системы управления средой VDI на резервном брокере</p></figcaption></figure>

После нажатия, в левом нижнем углу экрана отобразится всплывающее зеленое окно с надписью **Действие 'xrm\_openuds\_Fail\_Over' было успешно запущено**.

Это сообщение указывает на то, что задача на выполнение операции Fail\_Over была успешно создана, и поставлена в очередь для выполнения.

В меню навигации **ИСТОРИЯ** вы так же можете отслеживать ход выполнения процедуры **xrm\_openuds.Fail\_Over** по аналогии с предыдущим шагом.

<figure><img src="../../../../../.gitbook/assets/image (82).png" alt=""><figcaption><p>Процедура Fail_Over успешно выполнена</p></figcaption></figure>

Процедура **Fail\_Over** успешно завершена. Сервис-пул добавлен на резервную площадку.

<figure><img src="../../../../../.gitbook/assets/image (83).png" alt=""><figcaption><p>Windows Static Multiple –  сервис-пул на основе провайдера машин со статическим IP на резервном брокере</p></figcaption></figure>

<figure><img src="../../../../../.gitbook/assets/image (86).png" alt=""><figcaption><p>DemoUsers@ad - группа из аутентификатора Active Directory, привязанная к сервис-пулу Windows Static Multiple на резервном брокере</p></figcaption></figure>

<figure><img src="../../../../../.gitbook/assets/image (85).png" alt=""><figcaption><p>RDP - привязанный транспорт к сервис-пулу Windows Static Multiple на резервном брокере</p></figcaption></figure>



