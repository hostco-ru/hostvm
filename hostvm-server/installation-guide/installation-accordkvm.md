# Установка Accord KVM

## Установка пакета

`rpm -ivh ./Accord-KVM-1-3.el7.centos.x86_64.rpm --force`

## Создание БД

`accordkvm create-db`

## Настройка

В случае с HOSTVM Accord KVM позволяет работать только с запущенными на хосте машинами, в т.ч. разрешать их запуск, поэтому на период настройки необходимо включить softmode (непрошедшие контроль ВМ включаются, но эти события пишутся в лог: `/var/log/accordkvm/accordkvm.log`) командой:

`accordkvm set-softmode --enable`

После завершения настройки выключить softmode:

`accordkvm set-softmode --disable`

Текущие настройки контроля ВМ можно проверить командой:

`accordkvm get-vmcontrol <vmname> --verbose`

Список запущенных на хосте ВМ, в том числе их имена, можно получить командой:

`accordkvm get-vms`

### Контроль запуска

Разрешить запуск ВМ на хосте:

`accordkvm add-vmcontrol <vmname> --allow`

### Контроль конфигурации

Посмотреть текущую конфигурацию ВМ:

`accordkvm get-vmcfg <vmname>`

Включить контроль конфигурации:

`accordkvm add-vmxcontrol <vmname>`

### Контроль целостности файлов

### Многосерверная конфигурация (кластер)

Для возможности работы ВМ на нескольких хостах, включая ее миграцию, требуется:

* включить softmode на период настройки;
* мигрировать ВМ по очереди на каждый хост;
* настроить контроль запуска, конфигурации, целостности файлов на каждом хосте.

В качестве альтернативного варианта можно:

* выполнить настройку на одном из хостов;
* скопировать изменения в БД Accord KVM на остальных хостах.

Дамп БД:

`sqlite3 /etc/accordkvm/database.db .dump > ./db.sql`

Добавление записей:

`sqlite3 /etc/accordkvm/database.db < ./db_add.sql`
