# Создание кластера

После развертывания HOSTVM создает пустой кластер с именем Default в дата-центре Default. Дополнительные кластеры могут быть созданы через портал администрирования. Данный раздел описывает процедуру создания кластера через портал администрирования. После создания кластера в него можно добавлять хосты, а также удалять их.

Инструкция по созданию кластера:

1. Откройте раздел Compute->Hosts, затем откройте хост, который хотите добавить в кластер, нажав на ссылку в поле Name. На вкладке General в разделе Hardware указаны аппаратные спецификации хоста. Значение поля CPU Type этих спецификаций потребуется при создании кластера, так как все хосты в нем должны иметь одинаковый CPU type;
2. Откройте раздел Compute->Clusters, нажмите New для создания нового кластера;
3. В появившемся окне на вкладке General в поле Data Center выберите дата-центр, в который необходимо добавить кластер;
4. Укажите имя кластера в поле Name. Опционально можно указать описание и комментарии к кластеру в полях Description и Comment;
5. В поле Management Network выберите логическую сеть для управляющего трафика кластера. При отсутствии других логических сетей это будет сеть по умолчанию для всего трафика;
6. В поле CPU architecture выберите архитектуру CPU хостов кластера. Эта архитектура едина для всех хостов кластера;
7. В поле CPU type выберите тип CPU хостов кластера. Этот тип един для всех хостов кластера. Типы CPU Intel и AMD перечислены в порядке от более старых моделей к более новым. Если выбранный тип CPU не поддерживается хостом кластера, такой хост не будет функционировать. Поэтому следует выбрать тип CPU, функции данного типа поддерживаются всеми хостами кластера (тип CPU должен совпадать с самой «старой» моделью);
8. В поле Compatibility Version выберите совместимую версию HOSTVM. Для нового кластера в общем случае необходимо выбирать последнюю доступную версию. Это позволяет контролировать протоколы и функции, используемые HOSTVM для управления кластером. Вы не можете выбрать версию ниже, чем указана в соответствующих настройках дата-центра, к которому принадлежит кластер. Таким образом, при обновлении системы на последнюю версию HOSTVM не нарушается функционирование существующей среды виртуализации;
9. В поле Switch type укажите тип коммутатора кластера. Доступны два типа: Linux Bridge и OVS. В большинстве случаев следует выбрать Linux Bridge;
10. Включение опции Enable Virt Service позволяет хостам кластера запускать ВМ, в типичном случае эта опция должна быть включена. Опция Enable Gluster Service предназначена для специальных кластеров, использующих службу GlusterFS, и в базовом случае не должна быть активирована. Опция /dev/hwrng source позволяет кластеру использовать аппаратный генератор случайных чисел вместо /dev/urandom. Это устройство должно быть доступно на всех хостах кластера в случае включения опции;
11. В дополнение к разделу General окно настроек кластера включает в себя другие разделы:\
    • Optimization – настройки оптимизации использования ресурсов кластера;\
    • Migration Policy – настройки политики миграции ВМ в кластере. Определяет условия для «живой» миграции ВМ в случае отказа хоста. Эти условия включают в себя приоритет ВМ для миграции, наличие простоя ВМ, пропускную способность сети. Настройки пропускной способности задают максимум для входящей и исходящей миграции хоста. Политики отказоустойчивости определяют приоритет ВМ при миграции;\
    • Scheduling Policy – настройка балансировки нагрузки в кластере. Позволяет настраивать использование ресурсов и распределение ВМ между доступными хостами. Настройте эту политику для обеспечения автоматической балансировки нагрузки между хостами кластера. Независимо от настроек политики, ВМ не запустится на хосте с перегруженным CPU. По умолчанию CPU хоста считается перегруженным, если его утилизация составляет 80 % и более в течение 5 минут, но это значение также может быть изменено настройками политики;\
    • Console – настройка SPICE proxy для графической консоли хостов кластера;\
    • Fencing policy – политика изоляции хостов кластера;\
    • MAC Address Pool – настройка пула MAC адресов, используемых кластером;
12. После завершения настроек нажмите OK. После этого появится новое окно Cluster - Guide Me. Данный конфигуратор позволяет добавить хосты в кластер. В случае создания нового кластера эти хосты могут быть еще не настроены. В таком случае можно закончить настройку кластера позже, нажав кнопку Conﬁgure Later.
