---
coverY: 0
---

# Установка HOSTVM Manager на NFS

После установки ISO-дистрибутива на сервер обратитесь по адресу, указанному в процессе установки на порт 9090 через браузер и зайдите под пользователем root.

Пароль root по умолчанию для новой версии hostvm node: HostvmNode.

Логин HOSTVM Manager по умолчанию: admin\
Пароль HOSTVM Manager по умолчанию: engine

Перейдите на вкладку Terminal

![](<../../../.gitbook/assets/image (56).png>)

### Настройка NFS-сервера

Создайте папку /data/nfs/iso-store

```
root@testname1 ~]# mkdir -p /data/nfs/iso-store
```

Создайте пользователей, необходимых для работы с хранилищем.

```
[root@testname1 ~]# groupadd kvm -g 36
[root@testname1 ~]# useradd vdsm -u 36 -g 36
```

Если nfs-хранилище будет настроено на хосте виртуализации, то при создании появится сообщение, что пользователь и группа уже существуют

Настройте права доступа на созданную папку

```
[root@testname1 ~]# chown -R 36:36 /data/nfs/iso-store
[root@testname1 ~]# chmod 0755 /data/nfs/iso-store
```

Установим необходимые пакеты

```
[root@testname1 ~]# yum install nfs-utils -y
```

Добавим необходимые службы в автозагрузку и включим

```
[root@testname1 ~]# systemctl enable rpcbind nfs-server
[root@testname1 ~]# systemctl start rpcbind nfs-server
```

Настроим файл конфигурации nfs-сервера. Откройте файл /etc/exports для редактирования:

```
[root@testname1 ~]# nano /etc/exports
```

Введите следующий текст (вместо 10.1.99.0/24 введите вашу IP-подсеть):

```
/data/nfs/iso-store 10.1.99.0/24(rw)
```

Важно!: необходимо соблюдать формат записи, лишних пробелов быть не должно. В данной записи:

/data/nfs/iso-store - путь к папке, которая будет nfs-хранилищем;

10.1.99.0/24 –IP-подсеть, которой разрешён доступ к nfs-хранилищу;

(rw) - набор опций для nfs-хранилища.

Сохраняем файл

Применяем новую конфигурацию командой:

```
[root@testname1 ~]# exportfs -r
```

Убедимся, что ресурсы опубликованы

```
[root@testname1 ~]# exportfs
# /data/nfs/iso-store 10.1.99.0/24
```

Если NFS-сервер сконфигурирован не на хосте виртуализации, необходимо добавить правила для файрволла на хосте. На NFS-сервере необходимо также добавить эти правила (в зависимости от ОС, команды могут отличаться), пример для firewalld:

```
[root@testname1 ~]# firewall-cmd --permanent --add-service=nfs
[root@testname1 ~]# firewall-cmd --permanent --add-service=mountd
[root@testname1 ~]# firewall-cmd --permanent --add-service=rpc-bind
[root@testname1 ~]# firewall-cmd --reload
```

### Установка HOSTVM Manager

На DNS-сервере должны быть как минимум две записи типа A, содержащие в себе FQDN-имя сервера, а также имя виртуальной машины hosted-engine, которая будет установлена.\
\
Если на DNS-сервере отсутствуют записи, то их можно добавить вручную на ноде HOSTVM: [deistviya-pri-ustanovke-hostvm-pri-otsutstvii-zapisei-v-dns.md](../deistviya-pri-ustanovke-hostvm-pri-otsutstvii-zapisei-v-dns.md "mention")

Перейдите на вкладку _Apps->Virtualization->Hosted Engine._

Напротив Hosted-engine нажмите кнопку _Start._

![](../../../.gitbook/assets/FC\_1.png)

Внимание! Объём NFS-хранилища должен быть не менее 80 Гб.

Заполните форму. Виртуальная машина создается со статическим файлом с использованием файла hosts.

![](../../../.gitbook/assets/FC\_2.png)

Значения задаваемых параметров:

| Параметр               | Значение                                                                                            | Примечание                                                                                             |
| ---------------------- | --------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------ |
| Engine VM FQDN         | Имя будущей виртуальной машины управления виртуализацией                                            | Имя должно разрешаться через файл _/etc/hosts_ или через DNS-сервер                                    |
| MAC Address            | MAC-адрес будущей виртуальной машины управления виртуализацией                                      | Можно оставить по умолчанию                                                                            |
| Network Configuration  | Способ получения IP-адреса                                                                          | Static или DHCP                                                                                        |
| VM IP Address          | Адрес виртуальной машины                                                                            |                                                                                                        |
| Gateway Address        | Адрес шлюза                                                                                         |                                                                                                        |
| DNS Servers            | DNS-серверы, прописываемые внутрь виртуальной машины                                                |                                                                                                        |
| Bridge Interface       | Каким физическим интерфейсом будет пользоваться виртуальная машина                                  | Можно оставить по умолчанию                                                                            |
| Root Password          | Пароль операционной системы виртуальной машины                                                      |                                                                                                        |
| Root SSH Access        | Может ли пользователь root авторизоваться через SSH-сервер                                          |                                                                                                        |
| Number of Virtual CPUs | Количество виртуальных ядер процессора, используемых виртуальной машиной                            | Рекомендуется не менее 4                                                                               |
| Memory Size (MiB)      | Память, используемая виртуальной машиной                                                            | Не менее 4096                                                                                          |
| Root SSH Public Key    | SSH-ключ безпарольного доступа внутрь виртуальной машины                                            |                                                                                                        |
| Bridge Name            | Имя виртуального сетевого интерфейса виртуальной машины                                             | Рекомендуется оставить по умолчанию                                                                    |
| Gateway Address        | Шлюз виртуальной машины                                                                             | Рекомендуется оставить по умолчанию                                                                    |
| Host FQDN              | Имя хоста виртуализации                                                                             | Рекомендуется оставить по умолчанию                                                                    |
| Edit Hosts File        | Создавать ли записи в hosts виртуальной машины                                                      | Рекомендуется включать опцию                                                                           |
| Pause Host             | Требуется ли приостанавливать установку для внесения своих изменений в настройки виртуальной машины | Не рекомендуется включать опцию                                                                        |
| Apply OpenSCAP profile | Профиль OpenSCP                                                                                     | Не рекомендуется включать опцию                                                                        |
| Network Test           | Проверка работоспособности виртуальной машины в процессе установки                                  | Рекомендуется выбрать _ping_ при использовании файла hosts. Можно оставить _DNS_ при использовании DNS |
| OVA Archive Path       | Путь до альтернативного образа виртуальной машины                                                   | Не рекомендуется использовать                                                                          |

Заполните следующую форму. Укажите пароль от веб-интерфейса будущей виртуальной машины. Заполните настройки отправки уведомлений e-mail при необходимости.

![](../../../.gitbook/assets/FC\_3.png)

Создайте управляющую виртуальную машину (нажмите _Prepare VM_).

![](../../../.gitbook/assets/FC\_4.png)

Подождите довольно продолжительное время, пока виртуальная машина не будет создана и настроена.

![](../../../.gitbook/assets/FC\_5.png)

Выберете тип хранилища NFS и укажите путь экспорта.

![](<../../../.gitbook/assets/image (67).png>)

Подождите пока hosted-engine расположится в хранилище.

![](../../../.gitbook/assets/FC\_7.png)

Поздравляем! Hosted-engine развернут.

![](../../../.gitbook/assets/FC\_8.png)

Логин HOSTVM Manager по умолчанию: admin\
Пароль HOSTVM Manager по умолчанию: engine

## Если что-то пошло не так

1. Проверить корректность данных, которые были введены в IP-wizard. При обнаружении ошибки выполните команду `ansible-playbook /etc/ansible/clean-node.yml` и начните сначала.
2. Если на этапе `/root/script-hosted-engine-deploy | tee -a /root/script-hosted-engine-deploy.log` появилась ошибка, то выполните команду `ansible-playbook /etc/ansible/clean-node.yml` и начните сначала
3. Если на этапе `ansible-playbook /etc/ansible/make-prepare.yml` появилась ошибка, повторите выполнение данной команды
4. Если на этапе `ansible-playbook /etc/ansible/make-gluster-storages.yml` появилась ошибка, повторите выполнение данной команды
5. Если на этапе `ansible-playbook /etc/ansible/make-ovirt.yml` появилась ошибка, повторите выполнение данной команды
6. Если после завершения установки вам не открывается страница в браузере с адресом [https://engine.mydomain.ru](https://engine.mydomain.ru), то
   1. Проверьте, что ip для engine, указанный в таблице в начале установки отвечает на команду ping
   2. Проверьте, что имя `engine.mydomain.ru` разрешается вашим dns-сервером.
7. Если на этапе установки engine `/root/script-hosted-engine-deploy | tee -a /root/script-hosted-engine-deploy.log` установка зависает на этапе `Engine VM domain: [rtc.local]rtc.local Enter root password that will be used for the engine appliance: engine`, то подключитесь к консоли сервера не по SSH, а с помощью ipmi(iLO, iDRAC, etc.) и повторно запустите скрипт установки engine.

Схема установки hostvm и самостоятельного решения проблем представлена на рисунке ниже:

![](../../../.gitbook/assets/troubleshooting-scheme.jpg)

Если устранить проблему не удалось, обратитесь в [техническую поддержку](https://lk.pvhostvm.ru/) используя [инструкцию](https://lk.pvhostvm.ru/) К обращению приложите лог вывода вашей консоли, который был настроен в начале установки и файл `/root/script-hosted-engine-deploy.log`.
