# Установка HOSTVM через GUI 4.4

## **Перед установкой**

Перед установкой подготовьте диски вашего сервера: соберите диски в raid-группы используя инструкции вендора вашего оборудования.

Для установки необходимо использовать iso-образ HOSTVM Node, который доступна в [наборе дистрибутивов для развертывания решения](https://lk.pvhostvm.ru/Download)

Подключите полученный iso-образ к серверу, запустите сервер.

## **Процесс установки**

При загрузке откроется меню выбора действия. За 60 секунд выберите _Install HOSTVM Node 4.4.8_. Если за 60 секунд после загрузки не выбрать данный пункт, то начинается тестирование ресурсов сервера и только после этого начнется установка. Остановить тестирование ресурсов сервера возможно через нажатие клавиши _esc_.

![](<../../.gitbook/assets/boot menu.png>)

В случае если загрузка установщика зависнет, то нужно повторно загрузиться с установочного диска и в стартовом меню действий выбрать пункт «Troubleshooting», затем “Install HOSTVM Node 4.4.8 in basic graphics mode” для запуска установки с с использованием псевдографического интерфейса.

В открывшемся окне выберите английский язык (English), который будет использоваться в интерфейсе установщика.

_Выбранный язык не влияет на язык внутри самой операционной системы, которая устанавливается без графической оболочки._

Скриншоты инструкции выполнены в интерфейсе с английским языком. Нажмите _Continue_.

![](<../../.gitbook/assets/welcome (1).png>)

Далее автоматически открывается меню настроек.

![](<../../.gitbook/assets/inst summary.png>)

Перейдите в _DATE & TIME_, укажите ваш часовой пояс, время и дату. Нажмите _Done_.

![](../../.gitbook/assets/time.png)

**ВАЖНО!: Для корректной установки, необходимо, чтобы серверу, на этапе установки, был задан корректный IPv4 адрес, который имеет доступ в интернет (для доступа к репозиториям). Также должен быть указан корректный DNS сервер.**

&#x20;Перейдите в _NETWORK & HOST NAME_.

![](<../../.gitbook/assets/network menu.png>)

Выберите интерфейс, нажмите кнопку _Configure..._. В открывшемся окне перейдите на вкладку  General и отметьте пункт "Connect automatically with priority":

![](../../.gitbook/assets/network\_general.png)

Далее перейдите на вкладку _IPv4 Settings_, выберите _Method: Manual_, введите ip, маску, gw, DNS-сервер. Нажмите кнопку _Save_.

![](../../.gitbook/assets/network\_ipv4.png)

Переведите тригер возле названия подключения в положение _On_. В поле _Host name_ введите имя сервера, нажмите кнопку _Apply_. Нажмите кнопку _Done_.

![](../../.gitbook/assets/network\_ready.png)

Перейдите в _Instalation Destination_. Выберите диск на который необходимо выполнить установку. Выберите радиокнопку _Custom_. Нажмите _Done_.

![](<../../.gitbook/assets/installation destination.png>)

После выбора места установки автоматически открывается следующее меню.

![](<../../.gitbook/assets/manual partitioning\_0.png>)

Если диск уже использовался (имел таблицу разделов), то удалите их, как показано ниже.

![](<../../.gitbook/assets/manual partitioning\_3.png>)

![](<../../.gitbook/assets/manual partitioning\_4.png>)

Когда на диске не останется существующих разделов Из выпадающего меню выберите _LVM Thin Provisioning._ Нажмите _Click here to create them automatically_.

![](<../../.gitbook/assets/manual partitioning.png>)

Вы увидите, что на диске появилась предварительная разметка:

![](<../../.gitbook/assets/manual partitioning\_1.png>)

Удалите все пункты кроме /boot и /swap, как показано ниже.

![](../../.gitbook/assets/1-—-копия.png)

Для работы гипервизору необходимо минимум 90GB на системном диске. Для разворачивания виртуальной машины HOSTVM Engine необходим выделенный раздел для домена хранения, размер раздела необходимо задать согласно [системным требованиям](requirements.md#sistemnye-trebovaniya-dlya-virtualnoi-mashiny-engine-upravlenie-sistemoi-virtualizacii). \
Если необходимо, измените поле _Desired Capacity_ раздела _/_, чтобы изменить размер системного раздела. Не менее 16GB необходимо для раздела /var.

Далее создайте новый раздел с точкой монтирования в _/data:_

![](<../../.gitbook/assets/3\_1 (1).png>)

Нажмите _Done_.

Создайте раздел /var:

![](../../.gitbook/assets/4\_1.png)

Создайте раздел / (корневая файловая система):

![](../../.gitbook/assets/5\_1.png)

![Минимальная разметка для установки на локальные диски](../../.gitbook/assets/7\_1.png)

Подтвердите действие кнопкой _Accept Changes_.

![](../../.gitbook/assets/6\_1.png)

ВАЖНО! Далее необходимо задать пароль для пользователя root, если этого не сделать, вход в систему будет невозможен! Для этого необходимо в стартовом меню перейти в _Root Password_:

![](<../../.gitbook/assets/inst summary\_ready\_red\_arrow.png>)

Введите ваш пароль (рекомендуемый пароль **engine**). Дважды нажмите _Done_.

![](../../.gitbook/assets/root.png)

В стартовом меню нажмите кнопку _Begin Installation_, чтобы начать установку.

Если на этом этапе возникнет ошибка с postinstall скриптом, то это означает, что:

![](<../../.gitbook/assets/image (33).png>)

1\) Сервер не имеет доступа в интернет и не смог скачать установочные скрипты из репозитория

2\) Имя репозитория не распознано, т.к. DNS сервер не задан или не имеет доступа в интернет

3\) ISO образ для установки скачан давно, и некоторые пути в скриптах установки изменились - нужно скачать ISO заново и выполнить установку с него.

Альтернативно, можно выполнить данный скрипт вручную из ОС (смотри раздел - [прокси и репозиторий](https://kb.pvhostvm.ru/installation-guide/installation-hostvm-on-local-disks#nastroika-proksi-esli-ispolzuetsya-i-repozitoriya)).

Ожидайте окончания установки. После завершения подтвердите перезагрузку нажатием на кнопку _Reboot_.

![](../../.gitbook/assets/complete.png)

## Установка HOSTVM Manager на FC-диск

После установки ISO-дистрибутива на сервер обратитесь по адресу, указанному в процессе установки на порт 9090 через браузер и зайдите под пользователем root.

![](../../.gitbook/assets/4.4.8.PNG)

Пример адреса: [https://192.168.0.5:9090](https://192.168.0.5:9090)

Перейдите на вкладку _Apps->Virtualization->Hosted Engine._

Напротив Hosted-engine нажмите кнопку _Start._

![](../../.gitbook/assets/FC\_1.png)

Внимание! FC-диск для организации хранилища виртуальных машин должен отвечать следующим требованиям:

* объем диска – не менее 80 Gb;
* диск должен быть пустым и не содержать в себе какой-либо файловой системы;
* диск не может быть примонтирован к текущей файловой системе.

На DNS-сервере должны быть как минимум две записи типа A, содержащие в себе FQDN-имя сервера, а также имя виртуальной машины hosted-engine, которая будет установлена.

Заполните форму. Виртуальная машина создается со статическим файлом с использованием файла hosts.

![](../../.gitbook/assets/FC\_2.png)

Значения задаваемых параметров:

| Параметр               | Значение                                                                                            | Примечание                                                                                             |
| ---------------------- | --------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------ |
| Engine VM FQDN         | Имя будущей виртуальной машины управления виртуализацией                                            | Имя должно разрешаться через файл _/etc/hosts_ или через DNS-сервер                                    |
| MAC Address            | MAC-адрес будущей виртуальной машины управления виртуализацией                                      | Можно оставить по умолчанию                                                                            |
| Network Configuration  | Способ получения IP-адреса                                                                          | Static или DHCP                                                                                        |
| VM IP Address          | Адрес виртуальной машины                                                                            |                                                                                                        |
| Gateway Address        | Адрес шлюза                                                                                         |                                                                                                        |
| DNS Servers            | DNS-серверы, прописываемые внутрь виртуальной машины                                                |                                                                                                        |
| Bridge Interface       | Каким физическим интерфейсом будет пользоваться виртуальная машина                                  | Можно оставить по умолчанию                                                                            |
| Root Password          | Пароль операционной системы виртуальной машины                                                      |                                                                                                        |
| Root SSH Access        | Может ли пользователь root авторизоваться через SSH-сервер                                          |                                                                                                        |
| Number of Virtual CPUs | Количество виртуальных ядер процессора, используемых виртуальной машиной                            | Рекомендуется не менее 4                                                                               |
| Memory Size (MiB)      | Память, используемая виртуальной машиной                                                            | Не менее 4096                                                                                          |
| Root SSH Public Key    | SSH-ключ безпарольного доступа внутрь виртуальной машины                                            |                                                                                                        |
| Bridge Name            | Имя виртуального сетевого интерфейса виртуальной машины                                             | Рекомендуется оставить по умолчанию                                                                    |
| Gateway Address        | Шлюз виртуальной машины                                                                             | Рекомендуется оставить по умолчанию                                                                    |
| Host FQDN              | Имя хоста виртуализации                                                                             | Рекомендуется оставить по умолчанию                                                                    |
| Edit Hosts File        | Создавать ли записи в hosts виртуальной машины                                                      | Рекомендуется включать опцию                                                                           |
| Pause Host             | Требуется ли приостанавливать установку для внесения своих изменений в настройки виртуальной машины | Не рекомендуется включать опцию                                                                        |
| Apply OpenSCAP profile | Профиль OpenSCP                                                                                     | Не рекомендуется включать опцию                                                                        |
| Network Test           | Проверка работоспособности виртуальной машины в процессе установки                                  | Рекомендуется выбрать _ping_ при использовании файла hosts. Можно оставить _DNS_ при использовании DNS |
| OVA Archive Path       | Путь до альтернативного образа виртуальной машины                                                   | Не рекомендуется использовать                                                                          |

Заполните следующую форму. Укажите пароль от веб-интерфейса будущей виртуальной машины. Заполните настройки отправки уведомлений e-mail при необходимости.

![](../../.gitbook/assets/FC\_3.png)

Создайте управляющую виртуальную машину (нажмите _Prepare VM_).

![](../../.gitbook/assets/FC\_4.png)

Подождите довольно продолжительное время, пока виртуальная машина не будет создана и настроена.

![](../../.gitbook/assets/FC\_5.png)

Выберете тип хранилища _Fibre Channel_ и укажите свободный LUN.

![](../../.gitbook/assets/FC\_6.png)

Подождите пока hosted-engine расположится в хранилище.

![](../../.gitbook/assets/FC\_7.png)

Поздравляем! Hosted-engine развернут.

![](../../.gitbook/assets/FC\_8.png)
