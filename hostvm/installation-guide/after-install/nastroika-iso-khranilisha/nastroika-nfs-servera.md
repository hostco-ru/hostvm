# Настройка NFS-сервера

NFS-сервер может быть установлен на одном из хостов виртуализации.

Создайте пользователей, необходимых для работы с хранилищем. Если nfs-хранилище будет настроено на одном из хостов виртуализации, этот шаг можно пропустить, поскольку пользователь и группа уже существуют.&#x20;

```
groupadd kvm -g 36
useradd vdsm -u 36 -g 36
```

Создайте папку, где будет располагаться хранилище, настройте права доступа на нее:

{% hint style="danger" %}
Не рекомендуется размещать NFS-хранилища в корневой директории (root или /).
{% endhint %}

```
mkdir -p /nfs/iso-stor
```

{% hint style="info" %}
Если к созданной директории необходимо примонтировать устройство, то выполните следующую команду перед выполнением дальнейших действий:

<pre><code><strong>mount /dev/&#x3C;имя устройства> /data/nfs/iso-storage
</strong></code></pre>
{% endhint %}

<pre><code><strong>chown -R 36:36 /nfs/iso-stor
</strong>chmod 0755 /nfs/iso-stor
</code></pre>



Установите необходимые пакеты, добавьте службы в автозагрузку и запустите:

```
yum install nfs-utils -y
systemctl enable rpcbind nfs-server
systemctl start rpcbind nfs-server
```



Настройте файл конфигурации nfs-сервера. Для работы будем использовать текстовый редактор `nano`. Установите его командой:

```
yum install nano -y
```

Откройте файл /etc/exports для редактирования:

```
nano /etc/exports
```

Добавьте запись:

```
/nfs/iso-stor 10.1.140.0/25(rw)
```

**Важно!:** необходимо соблюдать формат, лишних пробелов быть не должно.

В данной записи:

```
/nfs/iso-stor - путь к папке, которая будет nfs-хранилищем;
10.1.140.0/25 –IP-подсеть, которой разрешён доступ к nfs-хранилищу;
(rw) - набор опций для nfs-хранилища.
```

Клавишей 'ctrl'+'o' сохраните файл. Клавишей 'ctrl'+'x' выйдите из редактора.

Примените новую конфигурацию командой `exportfs -r`

Убедитесь, что ресурсы опубликованы:

```
exportfs
/nfs/iso-stor   10.1.140.0/25
```

Для доступа к хранилищу с других хостов добавьте соответствующие правила межсетевого экрана:

```
firewall-cmd --zone=public --add-service=nfs --permanent
firewall-cmd --zone=public --add-service=rpc-bind --permanent
firewall-cmd --reload
```
