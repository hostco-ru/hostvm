# Расширенные настройки кластера

Раздел Optimization:

| Поле                | Описание                                                                                                                                                                                                                                      |
| ------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Memory Optimization | <p>None – отключение memory overcommit.</p><p>For Server Load – позволяет выделять 150 % физической памяти каждого хоста.</p><p>For Desktop Load – позволяет выделять 200 % физической памяти каждого хоста</p>                               |
| CPU Threads         | Позволяет хостам запускать ВМ с общим количество ядер vCPU большим, чем количество ядер CPU хоста                                                                                                                                             |
| Memory Balloon      | Включение Memory Ballooning для ВМ кластера. Когда включено, Memory Overcommit Manager (MoM) регулирует потребление памяти везде, где это возможно, с ограничением снизу на заданное количество гарантированной памяти в настройках каждой ВМ |
| KSM control         | Позволяет MoM использовать функцию Kernel Same-page Merging (KSM), когда это необходимо и когда эффект экономии памяти больше затрат CPU                                                                                                      |

Раздел Migration Policy:

| Поле              | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| ----------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Migration policy  | <p>Minimal downtime – политика, позволяющая ВМ мигрировать в типичных ситуациях, с минимальным простоем.</p><p>Post-copy migration – политика, оптимальная для миграции ВМ под высокой постоянной нагрузкой. ВМ перезапускается на целевом хосте с передачей минимально необходимых страниц памяти, остальные переносятся в процессе работы ВМ. Возможно существенное замедление работы ВМ в фазе post-copy, когда переносятся недостающие части памяти.</p><p>Suspend workload if needed – политика, позволяющая ВМ мигрировать в большинстве случаев, включая ВМ под высокой нагрузкой. Поэтому время простоя может быть существенно больше, чем в других вариантах</p> |
| Bandwidth         | <p>Настройка пропускной способности сети для миграции.</p><p>Auto – значение берется из параметра Rate Limit [Mbps] настроек Host Network QoS дата-центра. Если не указано, рассчитывается из пропускной способности интерфейса хоста. Если пропускная способность интерфейса недоступна, определяется службой VDSM на хосте.</p><p>Hypervisor default – определяется службой VDSM на хосте.</p><p>Custom – задается вручную (в Mbps). Значение делится на количество одновременных миграций (по умолчанию две – входящая и исходящая). Например, если задано 600 Mbps, реальная пропускная способность для миграции одной ВМ будет 300 Mbps</p>                          |
| Resilience policy | <p>Migrate Virtual Machines – мигрировать все ВМ в соответствии с их приоритетом.</p><p>Migrate only Highly Available Virtual Machines – мигрировать только высокодоступные ВМ.</p><p>Do Not Migrate Virtual Machines – запретить миграцию ВМ</p>                                                                                                                                                                                                                                                                                                                                                                                                                         |

Раздел Scheduling Policy:

| Поле                   | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Select Policy          | <p>None – отключает балансировку нагрузки между хостами для уже запущенных ВМ. Это режим «по умолчанию». При запуске ВМ хост выбирается так, чтобы нагрузка на память и ЦП распределялась равномерно между всеми хостами в кластере. ВМ не запустятся на хосте, если он достиг заданных значений CpuOverCommitDurationMinutes, HighUtilization или MaxFreeMemoryForOverUtilized.</p><p>Evenly_distributed – равномерное распределение нагрузки на память и ЦП между всеми хостами в кластере. ВМ не запустятся на хосте, если он достиг заданных значений CpuOverCommitDurationMinutes, HighUtilization или MaxFreeMemoryForOverUtilized.</p><p>Cluster_maintenance – ограничивает активность в кластере во время задач обслуживания. Если установлена эта политика, нельзя запускать новые ВМ, за исключением ВМ с высокой доступностью. Если произойдет отказ хоста, ВМ с высокой доступностью будут перезапущены в соответствии с настройками. Любая ВМ может мигрировать.</p><p>Power_saving – распределение нагрузки на память и ЦП по подмножеству доступных хостов, чтобы снизить энергопотребление на незагруженных хостах. Хосты с загрузкой ЦП ниже значения LowUtilization в течение промежутка времени, превышающего заданный, мигрируют свои ВМ на другие хосты, чтобы их можно было отключить. ВМ не запустятся на хосте, если он достиг заданного значения HighUtilization.</p><p>Vm_evenly_distributed – равномерное распределение ВМ между хостами на основе их количества. Кластер считается несбалансированным, если на каком-либо хосте запущено больше ВМ, чем значение HighVmCount, и есть хотя бы один хост с числом ВМ, выходящим за пределы MigrationThreshold</p> |
| Scheduler Optimization | <p>Оптимизация балансировки с помощью критериев выбора хостов.</p><p>Optimize for Utilization – включить в балансировку критерии для оптимального выбора хоста.</p><p>Optimize for Speed – пропускать критерии выбора хоста в случаях наличия более 10 входящих запросов</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Enable HA Reservation  | Включает мониторинг и резервацию менеджером виртуализации свободных ресурсов кластера для миграции высокодоступных ВМ в случае отказа текущего хоста                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Serial Number Policy   | <p>Политика присвоения серийных номеров новым ВМ кластера.</p><p>Host ID – на основе UUID хоста.</p><p>Vm ID – на основе UUID ВМ.</p><p>Custom serial number – произвольное значение</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |

Раздел Fencing Policy:

| Поле                                           | Описание                                                                                                                                                                                                                                                                                                                     |
| ---------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Enable fencing                                 | Политика изоляции хостов кластера в случае отказов. Включена по умолчанию. Может быть выключена по необходимости, например, в случае проблем с сетью, пока идет диагностика и устранение, либо в периоды обслуживания. Если выключена, высокодоступные ВМ на хостах в статусе non-responsive не будут перезапущены на других |
| Skip fencing if host has live lease on storage | Если включено, хосты кластера в статусе Non Responsive, имеющие работающее подключение к хранилищу, не будут изолированы                                                                                                                                                                                                     |
| Skip fencing on cluster connectivity issues    | Если включено, изоляция будет временно выключена при проценте хостов с проблемами подключения к ним, равном либо выше заданного порогового значения: 25, 50, 75, и 100                                                                                                                                                       |
| Skip fencing if gluster bricks are up          | Доступна только при включенном функционале хранилища Gluster. Если политика включена, изоляция хостов не применяется при наличии на них работающих бриков и доступности с других пиров                                                                                                                                       |
| Skip fencing if gluster quorum not met         | Доступна только при включенном функционале хранилища Gluster. Если политика включена, изоляция хоста не применяется при наличии на нем работающих бриков, а также когда выключение хоста повлечет за собой потерю кворума                                                                                                    |
