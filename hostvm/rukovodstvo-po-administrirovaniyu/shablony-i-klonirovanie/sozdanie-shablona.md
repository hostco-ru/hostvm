# Создание шаблона

Для создания шаблона из существующей ВМ выполните следующую процедуру:

1. Создайте и подготовьте ВМ, которая послужит основой для шаблона;
2. Подготовьте образ, очистив его уникальных данных исходной ВМ, таких как MAC-адрес, имя машины, статический IP-адрес, логи, и другие данные;
3. Выключите ВМ;
4. Создайте шаблон, используя портал администрирования системы;
5. Протестируйте шаблон, создав другую ВМ на его основе.

Для ВМ Linux, image sealing возможно выполнить встроенными средствами HOSTVM (virt-sysprep) в процессе создания шаблона. Для ВМ с другими ОС подготовка образа должна быть выполнена перед созданием шаблона.

Для создания шаблона перейдите в раздел Compute > Virtual Machines, нажмите правой кнопкой мыши на ВМ, чтобы открыть контекстное меню, выберите пункт Make Template. Откроется окно создания нового шаблона, параметры которого описаны в следующей таблице:

| Поле                                    | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| --------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Name                                    | Имя шаблона. Должно быть уникальным в пределах системы, может состоять из букв в обоих регистрах, цифр, дефисов и подчеркиваний                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Description                             | Краткое описание шаблона. Не является обязательным                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Comment                                 | Произвольный текстовый комментарий                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Cluster                                 | Кластер, с которым будет ассоциирован шаблон. По умолчанию совпадает с кластером исходной ВМ, но может быть переназначен на любой кластер дата-центра                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| CPU Proﬁle                              | Опция расширенной настройки, позволяющая ограничить потребление ресурсов CPU хоста ВМ. Настройка по умолчанию - без ограничений. Используйте CPU Proﬁle для задания максимального количества вычислительных ресурсов хоста, доступного ВМ, выраженного как процент от общего количества доступных ресурсов хоста                                                                                                                                                                                                                                                                                                                               |
| Disks Allocation                        | <p>• Alias ­– алиас диска ВМ, используемый шаблоном. По умолчанию совпадает со значением исходной ВМ;</p><p>• Virtual Size ­– Размер диска. Данный параметр не может быть отредактирован;</p><p>• Format ­– формат дисков, который должен использовать шаблон. QCOW2 всегда подразумевает «тонкий» диск (thin provisioned). RAW, при использовании на файловом хранилище подразумевает thin provisioned диск, на блочном – preallocated;</p><p>• Target ­– домен хранения, на котором будет располагаться виртуальный диск. По умолчанию совпадает с доменом хранения исходной ВМ, но может быть переназначен на любой, доступный кластеру</p> |
| Allow all users to access this Template | Если включено, шаблон будет публичным, доступным всем пользователям. Если выключено, шаблон будет приватным, доступным только пользователям с ролью TemplateAdmin или SuperUser                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Copy VM permissions                     | Скопировать разрешения исходной ВМ на шаблон                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Seal Template                           | Подготовка шаблона с помощью virt-sysprep. Доступна только для ВМ с Linux                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |

Для создания sealed шаблона из существующей ВМ с Linux выполните следующую процедуру:

1. Из списка доступных ВМ выберите соответствующую, из которой будет создан шаблон;
2. Убедитесь, что она выключена;
3. Нажмите правой кнопкой мыши на ВМ, чтобы открыть контекстное меню, выберите пункт Make Template;
4. Задайте значения параметров Name, Description, и Comment;
5. Выберите кластер для шаблона;
6. При необходимости выберите CPU Proﬁle из списка доступных;
7. Выберите формат и профиль диска, домен хранения. По умолчанию используются значения исходной ВМ;
8. Чтобы сделать шаблон публичным, включите опцию Allow all users access to this Template;
9. Включите опцию Seal Template для автоматической подготовки и очистки образа Linux-based машины;
10. Нажмите OK для создания шаблона.

В процессе создания шаблона статус исходной ВМ изменится на Image Locked. Создание может занимать продолжительное время в зависимости от размера и количества виртуальных дисков, а также производительности системы хранения. После завершения шаблон будет доступен в разделе Compute > Templates.

Image sealing для ВМ с другими ОС должен быть выполнен вручную перед созданием шаблона. Процедура может отличаться в зависимости от используемой ОС. Например, для систем Microsoft Windows обычно используется утилита Sysprep.
