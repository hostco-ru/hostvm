# Виртуальная память

Подключить виртуальную память можно в «горячем» режиме. «Горячее» подключение означает включение или отключение устройств во время работы ВМ. Каждый раз, когда выполняется «горячая» замена памяти, она отображается как новое устройство памяти на вкладке «Vm Devices» в подробном представлении ВМ, максимум до 16 доступных слотов. Когда ВМ перезапускается, эти устройства удаляются из вкладки «Vm Devices» без уменьшения объема памяти ВМ, что позволяет оперативно подключать больше устройств памяти. В случае сбоя «горячей» замены (например, если больше нет доступных слотов), увеличение памяти будет применено при перезапуске ВМ.

Важно: эта функция в настоящее время не поддерживается для ВМ менеджера виртуализации.

Для «горячего» подключения виртуальной памяти необходимо:

1. Перейти «Compute» -> «Virtual Machines» и выбрать работающую ВМ;
2. Нажать «Edit»;
3. Перейти на вкладку «System»;
4. Увеличить размер памяти («Memory Size»), указав общий требуемый объем. Память может быть добавлена кратно 256 МБ. По умолчанию максимальный объем памяти, разрешенный для ВМ, устанавливается в 4 раза больше указанного размера памяти. Хотя значение максимального объема памяти и изменяется в пользовательском интерфейсе, но не подключается на «горячую». Поэтому значок ВМ изменится на сигнализирующий о необходимости применения изменений. Чтобы избежать этого, можно вернуть максимальный объем памяти к исходному значению;
5. Нажать «OK». Это действие открывает окно «Pending Virtual Machine changes», поскольку некоторые значения, такие как maxMemorySizeMb и minAllocatedMem, не изменяются, пока ВМ не будет перезапущена. Однако действие «горячей» замены запускается изменением значения «Memory Size», которое можно применить немедленно;
6. Нажать «OK».

Определенная ВМ память обновляется на вкладке «General» в представлении сведений. Увидеть недавно добавленное устройство памяти можно на вкладке «Vm Devices» в подробном представлении.

Отключить виртуальную память можно в «горячем» режиме. «Горячее» отключение означает отключение устройств во время работы ВМ.

Важно:

* в «горячем» режиме может быть отключена только память, добавленная с помощью «горячего» подключения;
* ОС ВМ должна поддерживать «горячее» отключение памяти;
* на ВМ не должно быть включено устройство для memory ballooning. По умолчанию эта функция отключена;
* все блоки оперативной памяти должны иметь значение online\_movable в правилах управления устройствами ВМ. На ВМ, работающих под управлением последних версий Linux или CoreOS, это правило установлено по умолчанию. Для получения информации о правилах управления устройствами следует обратиться к документации по ОС ВМ.

Если какое-либо из этих условий не выполняется, операция «горячего» отключения памяти может завершиться ошибкой или вызвать непредвиденное поведение.

Для «горячего» отключения виртуальной памяти необходимо:

1. Перейти «Compute» -> «Virtual Machines» и выбрать работающую ВМ;
2. Перейти на вкладку «Vm Devices»;
3. В столбце «Hot Unplug» нажать «Hot Unplug» рядом с устройством памяти, которое необходимо удалить;
4. Нажать «ОК» в окне «горячего» отключения памяти.

Гарантированное значение физической памяти для ВМ при необходимости автоматически уменьшается.
